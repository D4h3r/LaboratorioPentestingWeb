const express = require('express');
const router = express.Router();
const Usuario = require('../models/usuario');

router.post('/validate-xss-medium', (req, res) => {
  const { userId, url } = req.body;
  if (!userId || !url) {
    return res.status(400).json({ success: false, message: 'Faltan par√°metros requeridos.' });
  }

  // Verificar si la URL contiene un intento de XSS
  const xssPattern = /<script|onerror|alert/;
  if (xssPattern.test(url)) {
    // Actualizar puntos del usuario
    Usuario.updatePointsAndLevels(userId, 20, 'xss-medium', (err) => {
      if (err) {
        return res.status(500).json({ success: false, message: 'Error actualizando puntos.' });
      }
      return res.json({ success: true, message: 'Intento de XSS detectado. Nivel completado.' });
    });
  } else {
    res.json({ success: false, message: 'Payload incorrecto. Intenta de nuevo.' });
  }
});

module.exports = router;
