const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const fs = require('fs');

// Construye la ruta al archivo de la base de datos
const dbPath = path.resolve(__dirname, 'mydatabase.db');
console.log('Database path:', dbPath); // Imprime la ruta de la base de datos

// Verifica si el directorio y el archivo de la base de datos existen
const dbDir = path.dirname(dbPath);
if (!fs.existsSync(dbDir)) {
  console.log(`Creating directory: ${dbDir}`);
  fs.mkdirSync(dbDir, { recursive: true });
} else {
  console.log(`Directory exists: ${dbDir}`);
}

if (!fs.existsSync(dbPath)) {
  console.log(`Creating database file: ${dbPath}`);
  fs.writeFileSync(dbPath, '');
} else {
  console.log(`Database file exists: ${dbPath}`);
}

// Establecer permisos de lectura y escritura para todos
fs.chmodSync(dbPath, 0o666); // rw-rw-rw-

// Crea la base de datos si no existe y abre la conexiÃ³n
const db = new sqlite3.Database(dbPath, (err) => {
  if (err) {
    console.error('Could not open database:', err.message);
    throw err;
  } else {
    console.log('Connected to the SQLite database.');
  }
});

module.exports = db;
